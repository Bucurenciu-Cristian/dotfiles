#!/bin/bash
# Script to switch to single monitor mode on GNOME/Wayland

# Monitor selection (change this to your preferred monitor)
# Options: DP-2, DP-3, DP-4, eDP-1
PRIMARY_MONITOR="DP-4"  # Iiyama 34" monitor

# Backup current configuration
BACKUP_DIR="$HOME/bin/monitors/configs"
mkdir -p "$BACKUP_DIR"

# Check if monitors.xml exists
MONITORS_XML="$HOME/.config/monitors.xml"
if [ -f "$MONITORS_XML" ]; then
    cp "$MONITORS_XML" "$BACKUP_DIR/monitors-backup-$(date +%Y%m%d-%H%M%S).xml"
    echo "Current configuration backed up"
fi

# Create single monitor configuration
cat > "$BACKUP_DIR/single-monitor.xml" << 'EOF'
<monitors version="2">
  <configuration>
    <logicalmonitor>
      <x>0</x>
      <y>0</y>
      <scale>1</scale>
      <primary>yes</primary>
      <monitor>
        <monitorspec>
          <connector>DP-4</connector>
          <vendor>IVM</vendor>
          <product>PL3481WQ</product>
        </monitorspec>
        <mode>
          <width>3440</width>
          <height>1440</height>
          <rate>99.981605529785156</rate>
        </mode>
      </monitor>
    </logicalmonitor>
  </configuration>
</monitors>
EOF

# Copy the new configuration
cp "$BACKUP_DIR/single-monitor.xml" "$MONITORS_XML"

# Restart GNOME Shell to apply changes (only works on X11)
# For Wayland, we need to log out and back in, or use a different method

echo "Single monitor configuration applied!"
echo "You may need to:"
echo "1. Press Alt+F2 and type 'r' to restart GNOME Shell (X11 only)"
echo "2. Or log out and log back in (Wayland)"
echo "3. Or the changes might apply automatically"

# Alternative: Try to apply changes using gsettings
# This might trigger a reload of the display configuration
gsettings set org.gnome.desktop.interface enable-animations false
sleep 0.1
gsettings set org.gnome.desktop.interface enable-animations true

echo ""
echo "Monitor set to: $PRIMARY_MONITOR (Iiyama 34\")"